version: '3.8'

services:
  # Python Backend (Controller + Monitor, no GUI)
  smart-home-backend:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: smart_home_backend
    environment:
      - MQTT_HOST=910e146c7f1f4c0fa6799235de0cd0fe.s1.eu.hivemq.cloud
      - MQTT_PORT=8883
      - MQTT_USERNAME=main_connection
      - MQTT_PASSWORD=dycrax-3ruzdU
      - PYTHONUNBUFFERED=1
      - NO_GUI=true
    volumes:
      - ./db:/app/db
      - ./Heating:/app/Heating
    network_mode: 'host'
    restart: unless-stopped
    depends_on:
      - nodered

  # Node-RED for Heating System Simulation
  nodered:
    image: nodered/node-red:latest
    container_name: node_red_heating
    ports:
      - '1880:1880'
    environment:
      - TZ=Europe/Budapest
    volumes:
      - ./Heating/node-red:/data
    restart: unless-stopped
