version: '3.8'

services:
  # Python Smart Home Application (Controller + Monitor + GUI)
  smart-home-app:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: smart_home_app
    environment:
      # MQTT Broker Configuration
      - MQTT_HOST=910e146c7f1f4c0fa6799235de0cd0fe.s1.eu.hivemq.cloud
      - MQTT_PORT=8883
      - MQTT_USERNAME=main_connection
      - MQTT_PASSWORD=dycrax-3ruzdU
      # Display for Tkinter GUI
      - DISPLAY=${DISPLAY}
      # Python settings
      - PYTHONUNBUFFERED=1
    volumes:
      # Shared database
      - ./db:/app/db
      # Heating module
      - ./Heating:/app/Heating
      # X11 socket for GUI
      - /tmp/.X11-unix:/tmp/.X11-unix
    network_mode: 'host'
    restart: unless-stopped
    depends_on:
      - nodered

  # Node-RED for Heating System Simulation
  nodered:
    image: nodered/node-red:latest
    container_name: node_red_heating
    ports:
      - '1880:1880'
    environment:
      - TZ=Europe/Budapest
    volumes:
      # Node-RED data directory (flows, settings, packages)
      - ./Heating/node-red:/data
    restart: unless-stopped

volumes:
  # Named volumes for persistence
  db_data:
  nodered_data:
